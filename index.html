<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RS Ranking Dashboard ‚Äî Relative Strength vs SPY</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Outfit:wght@300;400;600;700;900&display=swap" rel="stylesheet">
<style>
  :root {
    --bg-primary: #0a0a0f;
    --bg-card: #12121a;
    --bg-card-alt: #16161f;
    --bg-hover: #1e1e2a;
    --border: #2a2a3a;
    --text-primary: #e8e8f0;
    --text-secondary: #8888a0;
    --text-muted: #55556a;
    --green-strong: #00e676;
    --green-mid: #4caf50;
    --blue: #448aff;
    --yellow: #ffd740;
    --red: #ff5252;
    --accent: #00e676;
    --noise-opacity: 0.03;
    --glow-green: rgba(0,230,118,0.04);
    --glow-blue: rgba(68,138,255,0.03);
    --quad-green: rgba(0,230,118,0.04);
    --quad-yellow: rgba(255,215,64,0.04);
    --quad-red: rgba(255,82,82,0.04);
    --quad-blue: rgba(68,138,255,0.04);
    --grid-line: rgba(255,255,255,0.06);
    --cross-line: rgba(255,255,255,0.2);
    --quad-label-opacity: 0.3;
    --point-label: #e8e8f0;
    --shadow-color: rgba(0,0,0,0.4);
    --corr-neutral-bg: rgba(255,255,255,0.03);
  }
  [data-theme="light"] {
    --bg-primary: #f0f2f5;
    --bg-card: #ffffff;
    --bg-card-alt: #f8f9fa;
    --bg-hover: #e8ecf0;
    --border: #d0d5dd;
    --text-primary: #1a1a2e;
    --text-secondary: #5a5a7a;
    --text-muted: #8a8aa0;
    --green-strong: #0a8f4f;
    --green-mid: #2e7d32;
    --blue: #1565c0;
    --yellow: #f9a825;
    --red: #c62828;
    --accent: #0a8f4f;
    --noise-opacity: 0;
    --glow-green: transparent;
    --glow-blue: transparent;
    --quad-green: rgba(0,180,80,0.06);
    --quad-yellow: rgba(255,200,0,0.06);
    --quad-red: rgba(220,50,50,0.06);
    --quad-blue: rgba(50,120,220,0.06);
    --grid-line: rgba(0,0,0,0.06);
    --cross-line: rgba(0,0,0,0.2);
    --quad-label-opacity: 0.5;
    --point-label: #1a1a2e;
    --shadow-color: rgba(0,0,0,0.08);
    --corr-neutral-bg: rgba(0,0,0,0.03);
  }

  /* Theme toggle */
  .theme-toggle {
    position: fixed; top: 20px; right: 20px; z-index: 50;
    width: 52px; height: 28px; border-radius: 100px; border: none; cursor: pointer;
    background: var(--bg-card); border: 1px solid var(--border);
    display: flex; align-items: center; padding: 3px;
    transition: all 0.3s ease;
  }
  .theme-toggle:hover { border-color: var(--accent); }
  .theme-toggle-knob {
    width: 22px; height: 22px; border-radius: 50%;
    background: var(--accent); display: flex; align-items: center; justify-content: center;
    font-size: 12px; transition: transform 0.3s ease;
  }
  [data-theme="light"] .theme-toggle-knob { transform: translateX(24px); }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { background: var(--bg-primary); color: var(--text-primary); font-family: 'Outfit', sans-serif; min-height: 100vh; overflow-x: hidden; }
  .noise-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E"); pointer-events: none; z-index: 0; opacity: var(--noise-opacity); }
  .glow-orb { position: fixed; border-radius: 50%; filter: blur(120px); pointer-events: none; z-index: 0; }
  .glow-orb-1 { top: -10%; right: -5%; width: 500px; height: 500px; background: var(--glow-green); }
  .glow-orb-2 { bottom: -10%; left: -5%; width: 400px; height: 400px; background: var(--glow-blue); }
  .container { position: relative; z-index: 1; max-width: 1400px; margin: 0 auto; padding: 24px 20px; }

  .tab-bar { display: flex; gap: 4px; margin-bottom: 24px; background: var(--bg-card); border: 1px solid var(--border); border-radius: 14px; padding: 4px; width: fit-content; }
  .tab-btn { padding: 10px 24px; border: none; border-radius: 10px; background: transparent; color: var(--text-secondary); font-family: 'Outfit', sans-serif; font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: all 0.25s ease; }
  .tab-btn:hover { color: var(--text-primary); }
  .tab-btn.active { background: var(--accent); color: var(--bg-primary); }
  .tab-content { display: none; }
  .tab-content.active { display: block; }

  .header { text-align: center; margin-bottom: 32px; padding: 40px 24px; background: var(--bg-card); border: 1px solid var(--border); border-radius: 20px; position: relative; overflow: hidden; }
  .header::before { content:''; position:absolute; top:0; left:0; right:0; height:2px; background:linear-gradient(90deg,transparent,var(--accent),transparent); }
  .header h1 { font-weight: 900; font-size: 2.4rem; letter-spacing: -1px; background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
  .header .subtitle { font-size: 0.95rem; color: var(--text-secondary); margin-top: 8px; font-weight: 300; }
  .header .benchmark-info { display: inline-flex; align-items: center; gap: 12px; margin-top: 16px; padding: 8px 20px; background: rgba(0,230,118,0.06); border: 1px solid rgba(0,230,118,0.15); border-radius: 100px; font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; color: var(--accent); }
  .pulse-dot { width:8px; height:8px; background:var(--accent); border-radius:50%; animation:pulse 2s ease-in-out infinite; }
  @keyframes pulse { 0%,100%{opacity:1;box-shadow:0 0 0 0 rgba(0,230,118,0.4)} 50%{opacity:0.7;box-shadow:0 0 0 8px rgba(0,230,118,0)} }

  .stats-bar { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 12px; margin-bottom: 28px; }
  .stat-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 14px; padding: 18px 20px; text-align: center; transition: all 0.3s ease; }
  .stat-card:hover { border-color: var(--accent); transform: translateY(-2px); }
  .stat-card .stat-value { font-family: 'JetBrains Mono', monospace; font-size: 1.6rem; font-weight: 700; }
  .stat-card .stat-label { font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1.5px; margin-top: 4px; }

  .filters { display: flex; gap: 8px; margin-bottom: 20px; flex-wrap: wrap; }
  .filter-btn { padding: 8px 18px; border: 1px solid var(--border); border-radius: 100px; background: transparent; color: var(--text-secondary); font-family: 'Outfit', sans-serif; font-size: 0.85rem; cursor: pointer; transition: all 0.25s ease; }
  .filter-btn:hover { border-color: var(--text-secondary); color: var(--text-primary); }
  .filter-btn.active { background: var(--accent); color: var(--bg-primary); border-color: var(--accent); font-weight: 600; }

  .sort-row { display:flex; align-items:center; gap:8px; margin-bottom:14px; font-size:0.8rem; color:var(--text-muted); }
  .sort-row select { background: var(--bg-card); color: var(--text-primary); border: 1px solid var(--border); border-radius: 8px; padding: 6px 12px; font-family: 'Outfit', sans-serif; font-size: 0.8rem; cursor: pointer; }

  .table-wrapper { background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px; overflow: hidden; }
  table { width: 100%; border-collapse: collapse; font-size: 0.88rem; }
  thead th { background: var(--bg-card-alt); color: var(--text-muted); font-family: 'JetBrains Mono', monospace; font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1.2px; padding: 14px 12px; text-align: center; font-weight: 600; border-bottom: 1px solid var(--border); white-space: nowrap; }
  tbody tr { border-bottom: 1px solid rgba(42,42,58,0.5); transition: background 0.2s ease; }
  tbody tr:hover { background: var(--bg-hover); }
  tbody td { padding: 12px; text-align: center; font-family: 'JetBrains Mono', monospace; font-size: 0.82rem; white-space: nowrap; }
  .rank-cell { font-weight: 700; font-size: 0.9rem; width: 50px; }
  .rank-top3 { color: var(--accent); }
  .ticker-cell { font-weight: 700; color: var(--text-primary); font-size: 0.9rem; text-align: left; padding-left: 16px; cursor: pointer; transition: color 0.2s; }
  .ticker-cell:hover { color: var(--accent); text-decoration: underline; }
  .category-cell { font-family: 'Outfit', sans-serif; font-size: 0.78rem; color: var(--text-secondary); text-align: left; }
  .rs-bar-cell { width: 130px; padding: 12px 8px; }
  .rs-bar-container { width:100%; height:22px; background:rgba(255,255,255,0.04); border-radius:4px; overflow:hidden; }
  .rs-bar { height:100%; border-radius:4px; transition:width 0.8s cubic-bezier(0.22,1,0.36,1); position:relative; }
  .rs-bar::after { content:''; position:absolute; top:0; left:0; right:0; bottom:0; background:linear-gradient(180deg,rgba(255,255,255,0.15) 0%,transparent 100%); border-radius:4px; }
  .rs-value { font-weight: 600; }
  .rs-positive { color: var(--green-strong); }
  .rs-negative { color: var(--red); }
  .rs-neutral { color: var(--yellow); }
  .pctl-badge { display:inline-block; padding:3px 10px; border-radius:6px; font-weight:600; font-size:0.78rem; min-width:48px; }
  .pctl-strong { background:rgba(0,230,118,0.15); color:var(--green-strong); }
  .pctl-positive { background:rgba(68,138,255,0.15); color:var(--blue); }
  .pctl-neutral { background:rgba(255,215,64,0.12); color:var(--yellow); }
  .pctl-weak { background:rgba(255,82,82,0.12); color:var(--red); }
  .signal-badge { display:inline-flex; align-items:center; gap:6px; padding:4px 12px; border-radius:100px; font-family:'Outfit',sans-serif; font-size:0.78rem; font-weight:600; }
  .signal-fuerte { background:rgba(0,230,118,0.1); color:var(--green-strong); border:1px solid rgba(0,230,118,0.2); }
  .signal-positivo { background:rgba(68,138,255,0.1); color:var(--blue); border:1px solid rgba(68,138,255,0.2); }
  .signal-neutral { background:rgba(255,215,64,0.08); color:var(--yellow); border:1px solid rgba(255,215,64,0.15); }
  .signal-debil { background:rgba(255,82,82,0.08); color:var(--red); border:1px solid rgba(255,82,82,0.15); }
  .signal-dot { width:6px; height:6px; border-radius:50%; }
  .dot-fuerte { background:var(--green-strong); box-shadow:0 0 6px var(--green-strong); }
  .dot-positivo { background:var(--blue); box-shadow:0 0 6px var(--blue); }
  .dot-neutral { background:var(--yellow); box-shadow:0 0 6px var(--yellow); }
  .dot-debil { background:var(--red); box-shadow:0 0 6px var(--red); }
  .loading { text-align:center; padding:80px 20px; }
  .loading-spinner { width:40px; height:40px; border:3px solid var(--border); border-top-color:var(--accent); border-radius:50%; animation:spin 0.8s linear infinite; margin:0 auto 16px; }
  @keyframes spin { to{transform:rotate(360deg)} }
  .loading-text { color:var(--text-muted); font-size:0.9rem; }
  .error-msg { text-align:center; padding:60px 20px; color:var(--red); }
  .last-update { text-align:center; margin-top:20px; font-size:0.75rem; color:var(--text-muted); font-family:'JetBrains Mono',monospace; }
  .fade-row { opacity:0; animation:fadeIn 0.4s ease forwards; }
  @keyframes fadeIn { to{opacity:1} }

  /* HEATMAP */
  .hm-container { background: var(--bg-card); border: 1px solid var(--border); border-radius: 20px; padding: 32px; }
  .hm-title { font-weight: 700; font-size: 1.3rem; margin-bottom: 4px; }
  .hm-subtitle { font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 20px; }
  .hm-controls { display: flex; align-items: center; gap: 8px; margin-bottom: 24px; flex-wrap: wrap; }
  .hm-control-label { font-size: 0.8rem; color: var(--text-muted); }
  .hm-select {
    background: var(--bg-card-alt); color: var(--text-primary); border: 1px solid var(--border);
    border-radius: 8px; padding: 8px 14px; font-family: 'Outfit', sans-serif; font-size: 0.85rem; cursor: pointer;
  }
  .hm-canvas { min-height: 400px; }
  .hm-group-section { margin-bottom: 20px; }
  .hm-group-label {
    font-weight: 700; font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 8px;
    padding-bottom: 6px; border-bottom: 1px solid var(--border);
    text-transform: uppercase; letter-spacing: 1px;
  }
  .hm-grid { display: flex; flex-wrap: wrap; gap: 4px; }
  .hm-cell {
    border-radius: 8px; display: flex; flex-direction: column; align-items: center;
    justify-content: center; padding: 8px 4px; cursor: pointer;
    transition: all 0.2s ease; position: relative; overflow: hidden;
    min-width: 70px; min-height: 65px;
  }
  .hm-cell:hover { transform: scale(1.08); z-index: 5; box-shadow: 0 4px 20px rgba(0,0,0,0.4); }
  .hm-cell-ticker {
    font-family: 'JetBrains Mono', monospace; font-weight: 700; font-size: 0.8rem;
    color: #fff; text-shadow: 0 1px 3px rgba(0,0,0,0.5);
  }
  .hm-cell-val {
    font-family: 'JetBrains Mono', monospace; font-weight: 600; font-size: 0.72rem;
    color: rgba(255,255,255,0.85); text-shadow: 0 1px 3px rgba(0,0,0,0.5); margin-top: 2px;
  }
  .hm-scale { display: flex; align-items: center; justify-content: center; gap: 12px; margin-top: 20px; }
  .hm-scale-bar { width: 250px; height: 14px; border-radius: 7px; background: linear-gradient(90deg, #b71c1c, #ef5350, #555, #43a047, #1b5e20); }
  .hm-scale-neg { font-size: 0.7rem; color: var(--red); font-family: 'JetBrains Mono', monospace; }
  .hm-scale-pos { font-size: 0.7rem; color: var(--green-strong); font-family: 'JetBrains Mono', monospace; }

  /* TradingView Modal */
  .tv-overlay {
    display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.7); backdrop-filter: blur(6px);
    z-index: 200; align-items: center; justify-content: center;
  }
  .tv-overlay.active { display: flex; }
  .tv-modal {
    background: var(--bg-card); border: 1px solid var(--border); border-radius: 20px;
    width: 92%; max-width: 1100px; height: 88vh; max-height: 850px;
    overflow: hidden; position: relative;
    box-shadow: 0 24px 80px rgba(0,0,0,0.5);
    animation: modalIn 0.3s ease;
    display: flex; flex-direction: column;
  }
  @keyframes modalIn { from { opacity:0; transform:scale(0.95) translateY(20px); } to { opacity:1; transform:scale(1) translateY(0); } }
  .tv-header {
    display: flex; align-items: center; justify-content: space-between;
    padding: 16px 24px; border-bottom: 1px solid var(--border); flex-shrink: 0;
  }
  .tv-header-left { display: flex; align-items: center; gap: 12px; flex-wrap: wrap; }
  .tv-ticker-label { font-family: 'JetBrains Mono', monospace; font-weight: 700; font-size: 1.3rem; color: var(--accent); }
  .tv-cat-label { font-size: 0.82rem; color: var(--text-secondary); }
  .tv-rs-info { display: flex; gap: 16px; font-family: 'JetBrains Mono', monospace; font-size: 0.78rem; }
  .tv-close {
    width: 36px; height: 36px; border-radius: 10px; border: 1px solid var(--border);
    background: transparent; color: var(--text-secondary); font-size: 1.2rem;
    cursor: pointer; display: flex; align-items: center; justify-content: center;
    transition: all 0.2s; flex-shrink: 0;
  }
  .tv-close:hover { background: var(--red); color: #fff; border-color: var(--red); }
  .tv-body { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
  .tv-chart-container { width: 100%; flex: 1; min-height: 0; }
  .tv-holdings-panel {
    border-top: 1px solid var(--border); padding: 16px 24px; flex-shrink: 0;
    max-height: 240px; overflow-y: auto;
  }
  .tv-holdings-title {
    font-weight: 700; font-size: 0.85rem; color: var(--text-secondary);
    text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px;
    display: flex; align-items: center; gap: 8px;
  }
  .tv-holdings-title .etf-meta {
    font-weight: 400; font-size: 0.75rem; color: var(--text-muted);
    text-transform: none; letter-spacing: 0;
  }
  .holdings-grid {
    display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 6px;
  }
  .holding-item {
    display: flex; align-items: center; justify-content: space-between;
    padding: 7px 12px; background: var(--bg-card-alt); border: 1px solid var(--border);
    border-radius: 8px; font-family: 'JetBrains Mono', monospace; font-size: 0.75rem;
    transition: border-color 0.2s;
  }
  .holding-item:hover { border-color: var(--accent); }
  .holding-ticker { font-weight: 700; color: var(--text-primary); }
  .holding-name { font-family: 'Outfit', sans-serif; font-size: 0.7rem; color: var(--text-muted); margin-left: 6px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 80px; }
  .holding-weight { color: var(--accent); font-weight: 600; white-space: nowrap; }
  .holdings-loading { color: var(--text-muted); font-size: 0.8rem; padding: 12px 0; }

  /* CORRELATION MATRIX */
  .corr-container { background: var(--bg-card); border: 1px solid var(--border); border-radius: 20px; padding: 32px; }
  .corr-title { font-weight: 700; font-size: 1.3rem; margin-bottom: 4px; }
  .corr-subtitle { font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 8px; }
  .corr-note { font-size: 0.75rem; color: var(--text-muted); margin-bottom: 24px; font-style: italic; }
  .corr-scroll { overflow-x: auto; margin-bottom: 20px; }
  .corr-table { border-collapse: collapse; }
  .corr-table th, .corr-table td {
    padding: 0; width: 52px; height: 52px; min-width: 52px;
    text-align: center; vertical-align: middle;
    font-family: 'JetBrains Mono', monospace; font-size: 0.68rem;
    border: 1px solid rgba(42,42,58,0.3);
    position: relative;
  }
  .corr-table th {
    background: var(--bg-card-alt); color: var(--text-secondary);
    font-weight: 700; font-size: 0.65rem; letter-spacing: 0.5px;
    position: sticky; z-index: 2;
  }
  .corr-table th.corr-row-header { left: 0; z-index: 3; text-align: right; padding-right: 8px; width: 60px; min-width: 60px; }
  .corr-table thead th { top: 0; }
  .corr-table td { font-weight: 600; cursor: default; transition: transform 0.15s ease; }
  .corr-table td:hover { transform: scale(1.15); z-index: 5; box-shadow: 0 0 12px rgba(0,0,0,0.5); }
  .corr-table td .corr-val { position: relative; z-index: 1; }

  .corr-scale { display: flex; align-items: center; gap: 8px; margin-top: 16px; justify-content: center; }
  .corr-scale-bar { width: 300px; height: 16px; border-radius: 8px; background: linear-gradient(90deg, #ff5252, #ff525240, #1a1a2e, #00e67640, #00e676); }
  .corr-scale-labels { display: flex; justify-content: space-between; width: 300px; font-size: 0.7rem; color: var(--text-muted); font-family: 'JetBrains Mono', monospace; }

  .corr-filter-row { display: flex; gap: 8px; margin-bottom: 20px; flex-wrap: wrap; align-items: center; }
  .corr-filter-label { font-size: 0.8rem; color: var(--text-muted); margin-right: 4px; }

  /* Tooltip for correlation */
  .corr-tooltip {
    position: fixed; background: var(--bg-card); border: 1px solid var(--border);
    border-radius: 10px; padding: 12px 16px; pointer-events: none; z-index: 100;
    font-size: 0.82rem; display: none; backdrop-filter: blur(8px);
    box-shadow: 0 8px 32px var(--shadow-color);
  }

  @media (max-width: 900px) {
    .header h1 { font-size: 1.6rem; }
    .table-wrapper { overflow-x: auto; }
    table { min-width: 1100px; }
    .container { padding: 12px 10px; }
    .tab-bar { width: 100%; }
    .tab-btn { flex: 1; text-align: center; padding: 10px 8px; font-size: 0.78rem; }
    .corr-table th, .corr-table td { width: 42px; height: 42px; min-width: 42px; font-size: 0.6rem; }
  }
</style>
</head>
<body>

<div class="noise-overlay"></div>
<div class="glow-orb glow-orb-1"></div>
<div class="glow-orb glow-orb-2"></div>

<button class="theme-toggle" id="theme-toggle" title="Cambiar tema">
  <div class="theme-toggle-knob" id="toggle-knob">üåô</div>
</button>

<div class="container">
  <div class="header">
    <h1>‚ö° RS Ranking Dashboard</h1>
    <div class="subtitle">Relative Strength vs SPY ‚Äî Datos en vivo actualizados cada 20 minutos</div>
    <div style="margin-top:10px;font-size:0.82rem;color:var(--text-secondary);">
      by <a href="https://jfpartners.net" target="_blank" style="color:var(--accent);text-decoration:none;font-weight:600;">JFPartners.net</a>
      <span style="margin:0 6px;opacity:0.4">¬∑</span>
      <a href="https://youtube.com/@JavierDv" target="_blank" style="color:var(--accent);text-decoration:none;font-weight:600;">Javierdelvalle</a>
    </div>
    <div class="benchmark-info">
      <div class="pulse-dot"></div>
      <span id="benchmark-text">Cargando datos...</span>
    </div>
  </div>

  <div class="tab-bar">
    <button class="tab-btn active" data-tab="table">üìä RS Table</button>
    <button class="tab-btn" data-tab="corr">üîó Correlaci√≥n</button>
    <button class="tab-btn" data-tab="heatmap">üü© Heatmap</button>
  </div>

  <!-- TAB 1: RS TABLE -->
  <div id="tab-table" class="tab-content active">
    <div class="stats-bar" id="stats-bar"></div>
    <div class="filters" id="filters"></div>
    <div class="sort-row">
      <span>Ordenar por:</span>
      <select id="sort-select">
        <option value="rank">Rank (RS Score)</option>
        <option value="rs1m">RS 1M</option>
        <option value="rs3m">RS 3M</option>
        <option value="rs12m">RS 12M</option>
        <option value="pctl">Percentil</option>
        <option value="rsVol">RS Volumen</option>
        <option value="ticker">Ticker A-Z</option>
      </select>
    </div>
    <div class="table-wrapper">
      <table><thead><tr>
        <th>#</th><th>RS</th><th>Ticker</th><th>Categor√≠a</th>
        <th>RS 1M</th><th>RS 3M</th><th>RS 6M</th><th>RS 12M</th>
        <th>RS Score</th><th>Pctl</th><th>Vol Rel</th><th>RS Vol</th><th>Se√±al</th>
      </tr></thead><tbody id="table-body">
        <tr><td colspan="13" class="loading"><div class="loading-spinner"></div><div class="loading-text">Cargando datos desde Google Sheets...</div></td></tr>
      </tbody></table>
    </div>
  </div>

  <!-- TAB 3: CORRELATION -->
  <div id="tab-corr" class="tab-content">
    <div class="corr-container">
      <div class="corr-title">üîó Matriz de Correlaci√≥n Sectorial</div>
      <div class="corr-subtitle">Basada en perfiles de ROC (1M, 3M, 6M, 12M) ‚Äî Muestra similitud de comportamiento entre ETFs</div>
      <div class="corr-note">‚ö†Ô∏è Aproximaci√≥n basada en 4 puntos de ROC. Para correlaci√≥n precisa se necesitar√≠an retornos diarios hist√≥ricos.</div>
      <div class="corr-filter-row">
        <span class="corr-filter-label">Mostrar:</span>
        <div id="corr-filters"></div>
      </div>
      <div class="corr-scroll" id="corr-scroll"></div>
      <div class="corr-scale">
        <span style="font-size:0.7rem;color:var(--red)">-1.0</span>
        <div class="corr-scale-bar"></div>
        <span style="font-size:0.7rem;color:var(--green-strong)">+1.0</span>
      </div>
      <div style="text-align:center;margin-top:4px;font-size:0.68rem;color:var(--text-muted)">Correlaci√≥n negativa ‚Üê ‚Üí Correlaci√≥n positiva</div>
    </div>
    <div class="corr-tooltip" id="corr-tooltip"></div>
  </div>

  <!-- TAB: HEATMAP -->
  <div id="tab-heatmap" class="tab-content">
    <div class="hm-container">
      <div class="hm-title">üü© Mapa de Calor Sectorial</div>
      <div class="hm-subtitle">Tama√±o proporcional al valor absoluto ‚Äî Color seg√∫n rendimiento positivo/negativo</div>
      <div class="hm-controls">
        <span class="hm-control-label">M√©trica:</span>
        <select id="hm-metric" class="hm-select">
          <option value="rsScore" selected>RS Score</option>
          <option value="rs1m">RS 1M</option>
          <option value="rs3m">RS 3M</option>
          <option value="rs6m">RS 6M</option>
          <option value="rs12m">RS 12M</option>
          <option value="roc1m">ROC 1M %</option>
          <option value="roc3m">ROC 3M %</option>
          <option value="roc6m">ROC 6M %</option>
          <option value="roc12m">ROC 12M %</option>
          <option value="pctlScore">Percentil</option>
        </select>
        <span class="hm-control-label" style="margin-left:16px">Agrupar por:</span>
        <select id="hm-group" class="hm-select">
          <option value="cat">Categor√≠a</option>
          <option value="subcat">Sub-categor√≠a</option>
          <option value="none">Sin agrupar</option>
        </select>
      </div>
      <div class="hm-canvas" id="hm-canvas"></div>
      <div class="hm-scale">
        <span class="hm-scale-neg">‚óÑ Negativo</span>
        <div class="hm-scale-bar"></div>
        <span class="hm-scale-pos">Positivo ‚ñ∫</span>
      </div>
    </div>
  </div>

  <div class="last-update" id="last-update"></div>
</div>

<!-- TradingView Chart Modal -->
<div class="tv-overlay" id="tv-overlay">
  <div class="tv-modal">
    <div class="tv-header">
      <div class="tv-header-left">
        <span class="tv-ticker-label" id="tv-ticker"></span>
        <span class="tv-cat-label" id="tv-cat"></span>
        <div class="tv-rs-info">
          <span id="tv-rs-score"></span>
          <span id="tv-signal"></span>
        </div>
      </div>
      <button class="tv-close" id="tv-close">‚úï</button>
    </div>
    <div class="tv-body">
      <div class="tv-chart-container" id="tv-chart-container"></div>
      <div class="tv-holdings-panel" id="tv-holdings-panel">
        <div class="tv-holdings-title">üì¶ Top Holdings <span class="etf-meta" id="tv-holdings-meta"></span></div>
        <div id="tv-holdings-content" class="holdings-loading">Cargando holdings...</div>
      </div>
    </div>
  </div>
</div>

<script>
const CSV_URL_RAW = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQ5uGhOzwIrat1XzG3IW0f_KOHywLJVWLQr6vSkAg2e2cKjX8lXB8iupdXf4zTlSA/pub?gid=1683781233&single=true&output=csv';
const CSV_URL = 'https://corsproxy.io/?' + encodeURIComponent(CSV_URL_RAW);

let allData = [], allDataWithSPY = [];
let activeFilter = 'Todos', currentSort = 'rank', corrFilter = 'Sector GICS';

// ===== TABS =====
document.querySelectorAll('.tab-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    const tab = btn.dataset.tab;
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    btn.classList.add('active');
    document.getElementById('tab-' + tab).classList.add('active');
    if (tab === 'corr' && allData.length) requestAnimationFrame(drawCorrelation);
    if (tab === 'heatmap' && allData.length) drawHeatmap();
  });
});

// ===== CSV =====
function parseCSV(text) {
  const rows = [], lines = text.split('\n');
  for (const line of lines) {
    const cols = []; let cur = '', inQ = false;
    for (let i = 0; i < line.length; i++) {
      const ch = line[i];
      if (ch === '"') inQ = !inQ;
      else if (ch === ',' && !inQ) { cols.push(cur.trim()); cur = ''; }
      else cur += ch;
    }
    cols.push(cur.trim()); rows.push(cols);
  }
  return rows;
}
function parseNum(str) {
  if (!str) return 0;
  let s = str.trim().replace(/["'$‚Ç¨\s]/g, '');
  if (!s) return 0;
  if (s.includes('.') && s.includes(',') && s.lastIndexOf(',') > s.lastIndexOf('.'))
    s = s.replace(/\./g, '').replace(',', '.');
  else if (s.includes('.') && s.includes(',') && s.lastIndexOf('.') > s.lastIndexOf(','))
    s = s.replace(/,/g, '');
  else if (s.includes(',')) s = s.replace(',', '.');
  const n = parseFloat(s); return isNaN(n) ? 0 : n;
}
function percentRank(arr, val) {
  const sorted = [...arr].sort((a,b) => a-b);
  let below = 0, equal = 0;
  for (const v of sorted) { if (v < val) below++; else if (Math.abs(v-val) < 0.0001) equal++; }
  return ((below + equal*0.5) / sorted.length) * 100;
}
function getSignalClass(p) { return p>=75?'fuerte':p>=50?'positivo':p>=25?'neutral':'debil'; }
function getSignalText(p) { return p>=75?'FUERTE':p>=50?'POSITIVO':p>=25?'NEUTRAL':'D√âBIL'; }
function getBarColor(p) { return p>=75?'var(--green-strong)':p>=50?'var(--blue)':p>=25?'var(--yellow)':'var(--red)'; }

// ===== FETCH CURRENT DATA =====
async function fetchData() {
  try {
    const resp = await fetch(CSV_URL);
    if (!resp.ok) throw new Error('Network error: ' + resp.status);
    const rows = parseCSV(await resp.text());
    let hIdx = -1;
    for (let i = 0; i < Math.min(rows.length, 10); i++) if (rows[i].some(c => c.trim() === 'Ticker')) { hIdx = i; break; }
    if (hIdx === -1) throw new Error('Header no encontrado');
    const hd = rows[hIdx].map(h => h.trim().toLowerCase());
    const col = {
      ticker: hd.indexOf('ticker'),
      cat: hd.findIndex(h => h==='categor√≠a'||h==='categoria'),
      subcat: hd.findIndex(h => h.includes('sub-categ')),
      roc1m: hd.findIndex(h => h.includes('roc 1m')),
      roc3m: hd.findIndex(h => h.includes('roc 3m')),
      roc6m: hd.findIndex(h => h.includes('roc 6m')),
      roc12m: hd.findIndex(h => h.includes('roc 12m')),
      precio: hd.findIndex(h => h.includes('precio actual')),
      volRel: hd.findIndex(h => h.includes('volumen relativo') || h.includes('vol relativo') || h.includes('vol. relativo')),
      rsVol: hd.findIndex(h => h.includes('rs vol') || h.includes('rs volume')),
    };
    const rawETFs = [];
    for (let i = hIdx+1; i < rows.length; i++) {
      const r = rows[i]; if (!r || r.length < 5) continue;
      const ticker = (r[col.ticker]||'').trim(); if (!ticker || ticker.length > 6) continue;
      rawETFs.push({ ticker, cat:(r[col.cat]||'').trim(), subcat:(r[col.subcat]||'').trim(),
        roc1m:parseNum(r[col.roc1m]), roc3m:parseNum(r[col.roc3m]),
        roc6m:parseNum(r[col.roc6m]), roc12m:parseNum(r[col.roc12m]), precio:parseNum(r[col.precio]),
        volRel: col.volRel >= 0 ? parseNum(r[col.volRel]) : null,
        rsVol: col.rsVol >= 0 ? parseNum(r[col.rsVol]) : null });
    }
    allDataWithSPY = rawETFs;
    const spy = rawETFs.find(e => e.ticker === 'SPY');
    if (!spy) throw new Error('SPY no encontrado');
    const etfs = rawETFs.filter(e => e.ticker !== 'SPY').map(e => ({
      ...e, rs1m:e.roc1m-spy.roc1m, rs3m:e.roc3m-spy.roc3m, rs6m:e.roc6m-spy.roc6m, rs12m:e.roc12m-spy.roc12m, volRel: e.volRel, rsVol: e.rsVol,
    }));
    etfs.forEach(e => { e.rsScore = e.rs1m*0.35 + e.rs3m*0.30 + e.rs6m*0.20 + e.rs12m*0.15; });
    const allScores = etfs.map(e => e.rsScore);
    etfs.forEach(e => { e.pctlScore = percentRank(allScores, e.rsScore); });
    etfs.sort((a,b) => b.rsScore - a.rsScore);
    etfs.forEach((e,i) => { e.rank = i+1; });
    allData = etfs;
    renderAll();
    document.getElementById('benchmark-text').textContent = `BENCHMARK: SPY ($${spy.precio.toFixed(2)}) | ${etfs.length} ETFs | LIVE`;
    document.getElementById('last-update').textContent = `√öltima actualizaci√≥n: ${new Date().toLocaleString('es-ES')} ‚Äî Auto-refresh cada 20 min`;
  } catch(err) {
    console.error(err);
    document.getElementById('table-body').innerHTML = `<tr><td colspan="13" class="error-msg"><p>‚ö†Ô∏è ${err.message}</p></td></tr>`;
  }
}

// ===== TABLE =====
function renderAll() { renderStats(); renderFilters(); renderTable(); renderCorrFilters(); }
function renderStats() {
  const s=allData.filter(d=>d.pctlScore>=75).length, p=allData.filter(d=>d.pctlScore>=50&&d.pctlScore<75).length;
  const w=allData.filter(d=>d.pctlScore<25).length;
  const avg=allData.length?(allData.reduce((a,d)=>a+d.rsScore,0)/allData.length).toFixed(1):'0';
  document.getElementById('stats-bar').innerHTML = `
    <div class="stat-card"><div class="stat-value" style="color:var(--green-strong)">${s}</div><div class="stat-label">üü¢ Fuerte</div></div>
    <div class="stat-card"><div class="stat-value" style="color:var(--blue)">${p}</div><div class="stat-label">üîµ Positivo</div></div>
    <div class="stat-card"><div class="stat-value" style="color:var(--red)">${w}</div><div class="stat-label">üî¥ D√©bil</div></div>
    <div class="stat-card"><div class="stat-value" style="color:var(--text-primary)">${avg}</div><div class="stat-label">RS Medio</div></div>
    <div class="stat-card"><div class="stat-value" style="color:var(--accent)">${allData[0]?.ticker||'‚Äî'}</div><div class="stat-label">üèÜ #1 RS</div></div>`;
}
function renderFilters() {
  const cats = ['Todos', ...new Set(allData.map(d=>d.cat).filter(Boolean))];
  document.getElementById('filters').innerHTML = cats.map(c=>`<button class="filter-btn ${c===activeFilter?'active':''}" onclick="setFilter('${c}')">${c}</button>`).join('');
}
function setFilter(c) { activeFilter=c; renderFilters(); renderTable(); }
function sortData(d) {
  const s=[...d];
  switch(currentSort) {
    case 'rank':s.sort((a,b)=>b.rsScore-a.rsScore);break;case 'rs1m':s.sort((a,b)=>b.rs1m-a.rs1m);break;
    case 'rs3m':s.sort((a,b)=>b.rs3m-a.rs3m);break;case 'rs12m':s.sort((a,b)=>b.rs12m-a.rs12m);break;
    case 'pctl':s.sort((a,b)=>b.pctlScore-a.pctlScore);break;case 'rsVol':s.sort((a,b)=>(b.rsVol||0)-(a.rsVol||0));break;case 'ticker':s.sort((a,b)=>a.ticker.localeCompare(b.ticker));break;
  } return s;
}
function renderTable() {
  let f = activeFilter==='Todos'?allData:allData.filter(d=>d.cat===activeFilter);
  f = sortData(f);
  const rsC = v => { const c=v>0.01?'rs-positive':v<-0.01?'rs-negative':'rs-neutral'; return `<span class="rs-value ${c}">${v>0?'+':''}${v.toFixed(2)}</span>`; };
  document.getElementById('table-body').innerHTML = f.map((d,i) => {
    const sig=getSignalClass(d.pctlScore), st=getSignalText(d.pctlScore), bw=Math.max(2,Math.min(100,d.pctlScore));
    
    // Volumen Relativo column
    let volRelHTML = '<span style="color:var(--text-muted)">‚Äî</span>';
    if (d.volRel !== null && d.volRel !== 0) {
      const vr = d.volRel;
      let vrIcon = '', vrClass = '', vrBg = '';
      if (vr >= 2.0) { vrIcon = 'üî•'; vrClass = 'color:var(--green-strong);font-weight:700'; vrBg = 'background:rgba(0,230,118,0.08);border-radius:6px;padding:3px 8px;'; }
      else if (vr > 1.0) { vrIcon = '‚ö°'; vrClass = 'color:var(--blue);font-weight:600'; vrBg = 'background:rgba(68,138,255,0.08);border-radius:6px;padding:3px 8px;'; }
      else { vrIcon = ''; vrClass = 'color:var(--text-muted)'; vrBg = ''; }
      volRelHTML = `<span style="${vrBg}${vrClass}" title="Vol Hoy / Vol Medio: ${vr.toFixed(2)}x">${vrIcon}${vrIcon?' ':''}${vr.toFixed(2)}x</span>`;
    }

    // RS Volume column
    let rsVolHTML = '<span style="color:var(--text-muted)">‚Äî</span>';
    if (d.rsVol !== null && d.rsVol !== 0) {
      const v = d.rsVol;
      let volIcon = '', volClass = '', volBg = '';
      if (v >= 2.0) { volIcon = 'üî•'; volClass = 'color:var(--green-strong);font-weight:700'; volBg = 'background:rgba(0,230,118,0.08);border-radius:6px;padding:3px 8px;'; }
      else if (v > 1.0) { volIcon = '‚ö°'; volClass = 'color:var(--blue);font-weight:600'; volBg = 'background:rgba(68,138,255,0.08);border-radius:6px;padding:3px 8px;'; }
      else { volIcon = ''; volClass = 'color:var(--text-muted)'; volBg = ''; }
      rsVolHTML = `<span style="${volBg}${volClass}" title="RS Volumen: ${v.toFixed(2)}x">${volIcon}${volIcon?' ':''}${v.toFixed(2)}x</span>`;
    }

    return `<tr class="fade-row" style="animation-delay:${Math.min(i*25,600)}ms">
      <td class="rank-cell ${d.rank<=3?'rank-top3':''}">${d.rank}</td>
      <td class="rs-bar-cell"><div class="rs-bar-container"><div class="rs-bar" style="width:${bw}%;background:${getBarColor(d.pctlScore)}"></div></div></td>
      <td class="ticker-cell" onclick="openChart('${d.ticker}','${(d.subcat||d.cat).replace(/'/g,"\\'")}',${d.rsScore.toFixed(2)},${d.pctlScore.toFixed(1)})">${d.ticker}</td><td class="category-cell">${d.subcat||d.cat}</td>
      <td>${rsC(d.rs1m)}</td><td>${rsC(d.rs3m)}</td><td>${rsC(d.rs6m)}</td><td>${rsC(d.rs12m)}</td>
      <td style="font-weight:700">${rsC(d.rsScore)}</td>
      <td><span class="pctl-badge pctl-${sig}">${d.pctlScore.toFixed(1)}</span></td>
      <td>${volRelHTML}</td>
      <td>${rsVolHTML}</td>
      <td><span class="signal-badge signal-${sig}"><span class="signal-dot dot-${sig}"></span>${st}</span></td></tr>`;
  }).join('');
}
document.getElementById('sort-select').addEventListener('change', e => { currentSort=e.target.value; renderTable(); });

// ===== CORRELATION MATRIX =====
window.addEventListener('resize',()=>{if(allData.length){if(document.getElementById('tab-corr').classList.contains('active'))drawCorrelation();}});
function pearsonCorr(a, b) {
  const n = a.length;
  if (n === 0) return 0;
  const meanA = a.reduce((s,v)=>s+v,0)/n, meanB = b.reduce((s,v)=>s+v,0)/n;
  let num=0, denA=0, denB=0;
  for (let i=0;i<n;i++) {
    const da=a[i]-meanA, db=b[i]-meanB;
    num+=da*db; denA+=da*da; denB+=db*db;
  }
  const den = Math.sqrt(denA)*Math.sqrt(denB);
  return den===0 ? 0 : num/den;
}

function corrColor(v) {
  const isLight = document.documentElement.dataset.theme === 'light';
  if (v >= 0.8) return { bg: isLight?'rgba(10,143,79,0.6)':'rgba(0,230,118,0.7)', fg:'#fff' };
  if (v >= 0.5) return { bg: isLight?'rgba(10,143,79,0.3)':'rgba(0,230,118,0.4)', fg: isLight?'#1a1a2e':'#e8e8f0' };
  if (v >= 0.2) return { bg: isLight?'rgba(10,143,79,0.1)':'rgba(0,230,118,0.15)', fg: isLight?'#1a1a2e':'#e8e8f0' };
  if (v >= -0.2) return { bg: isLight?'rgba(0,0,0,0.03)':'rgba(255,255,255,0.03)', fg: isLight?'#8a8aa0':'#8888a0' };
  if (v >= -0.5) return { bg: isLight?'rgba(198,40,40,0.1)':'rgba(255,82,82,0.15)', fg: isLight?'#1a1a2e':'#e8e8f0' };
  if (v >= -0.8) return { bg: isLight?'rgba(198,40,40,0.3)':'rgba(255,82,82,0.4)', fg: isLight?'#1a1a2e':'#e8e8f0' };
  return { bg: isLight?'rgba(198,40,40,0.6)':'rgba(255,82,82,0.7)', fg:'#fff' };
}

function renderCorrFilters() {
  const cats = ['Sector GICS', 'Industria', 'Tem√°tico', 'Factor', 'Todos'];
  document.getElementById('corr-filters').innerHTML = cats.map(c =>
    `<button class="filter-btn ${c===corrFilter?'active':''}" onclick="setCorrFilter('${c}')">${c}</button>`
  ).join('');
}
function setCorrFilter(c) { corrFilter=c; renderCorrFilters(); drawCorrelation(); }

function drawCorrelation() {
  // Use allDataWithSPY to include benchmarks too
  let data;
  if (corrFilter === 'Todos') {
    data = allDataWithSPY;
  } else {
    data = allDataWithSPY.filter(d => d.cat === corrFilter);
  }
  if (data.length < 2) {
    document.getElementById('corr-scroll').innerHTML = '<p style="color:var(--text-muted);padding:20px;">No hay suficientes ETFs en esta categor√≠a</p>';
    return;
  }

  // Build ROC vectors for each ETF
  const vectors = data.map(d => [d.roc1m, d.roc3m, d.roc6m, d.roc12m]);
  const n = data.length;

  // Calculate correlation matrix
  const corrMatrix = [];
  for (let i=0;i<n;i++) {
    corrMatrix[i] = [];
    for (let j=0;j<n;j++) {
      corrMatrix[i][j] = i===j ? 1 : pearsonCorr(vectors[i], vectors[j]);
    }
  }

  // Build HTML table
  let html = '<table class="corr-table"><thead><tr><th class="corr-row-header"></th>';
  for (let j=0;j<n;j++) html += `<th>${data[j].ticker}</th>`;
  html += '</tr></thead><tbody>';

  for (let i=0;i<n;i++) {
    html += `<tr><th class="corr-row-header">${data[i].ticker}</th>`;
    for (let j=0;j<n;j++) {
      const v = corrMatrix[i][j];
      const {bg,fg} = corrColor(v);
      const display = i===j ? '‚Äî' : v.toFixed(2);
      const opacity = i===j ? '0.3' : '1';
      html += `<td style="background:${bg};color:${fg};opacity:${opacity}"
                   data-row="${data[i].ticker}" data-col="${data[j].ticker}"
                   data-rowi="${data[i].subcat||data[i].cat}" data-coli="${data[j].subcat||data[j].cat}"
                   data-val="${v.toFixed(3)}"
                   onmouseenter="showCorrTT(event)" onmouseleave="hideCorrTT()">
                <span class="corr-val">${display}</span></td>`;
    }
    html += '</tr>';
  }
  html += '</tbody></table>';
  document.getElementById('corr-scroll').innerHTML = html;
}

function showCorrTT(e) {
  const td = e.target.closest('td');
  if (!td) return;
  const r = td.dataset.row, c = td.dataset.col, ri = td.dataset.rowi, ci = td.dataset.coli, v = parseFloat(td.dataset.val);
  if (r === c) return;
  const tt = document.getElementById('corr-tooltip');
  let interpretation = '';
  if (v >= 0.8) interpretation = 'üü¢ Muy alta ‚Äî Se mueven casi igual';
  else if (v >= 0.5) interpretation = 'üü¢ Alta ‚Äî Comportamiento similar';
  else if (v >= 0.2) interpretation = 'üîµ Moderada ‚Äî Cierta relaci√≥n';
  else if (v >= -0.2) interpretation = '‚ö™ Baja ‚Äî Poco relacionados (diversificaci√≥n)';
  else if (v >= -0.5) interpretation = 'üü° Negativa moderada ‚Äî Tienden a moverse opuesto';
  else interpretation = 'üî¥ Muy negativa ‚Äî Se mueven en direcci√≥n opuesta';

  tt.innerHTML = `
    <div style="font-weight:700;font-size:0.95rem;margin-bottom:2px">${r} ‚Üî ${c}</div>
    <div style="color:var(--text-muted);font-size:0.72rem;margin-bottom:8px">${ri} vs ${ci}</div>
    <div style="font-family:'JetBrains Mono';font-size:1.1rem;font-weight:700;margin-bottom:6px;color:${v>=0?'var(--green-strong)':'var(--red)'}">${v>=0?'+':''}${v.toFixed(3)}</div>
    <div style="font-size:0.78rem">${interpretation}</div>
  `;
  tt.style.display = 'block';
  tt.style.left = (e.clientX + 16) + 'px';
  tt.style.top = (e.clientY - 20) + 'px';
}
function hideCorrTT() { document.getElementById('corr-tooltip').style.display='none'; }

// ===== ETF HOLDINGS DATABASE =====
const ETF_HOLDINGS = {
  // === SECTOR GICS ===
  XLK: { name:'Technology Select Sector', expense:'0.09%', holdings:[
    {t:'AAPL',n:'Apple',w:21.5},{t:'MSFT',n:'Microsoft',w:19.8},{t:'NVDA',n:'NVIDIA',w:14.2},{t:'AVGO',n:'Broadcom',w:5.8},{t:'CRM',n:'Salesforce',w:3.2},
    {t:'ADBE',n:'Adobe',w:2.8},{t:'AMD',n:'AMD',w:2.5},{t:'CSCO',n:'Cisco',w:2.3},{t:'ORCL',n:'Oracle',w:2.2},{t:'ACN',n:'Accenture',w:2.0}]},
  XLF: { name:'Financial Select Sector', expense:'0.09%', holdings:[
    {t:'BRK.B',n:'Berkshire Hath.',w:14.2},{t:'JPM',n:'JPMorgan',w:10.8},{t:'V',n:'Visa',w:8.1},{t:'MA',n:'Mastercard',w:6.5},{t:'BAC',n:'Bank of America',w:4.2},
    {t:'WFC',n:'Wells Fargo',w:3.1},{t:'GS',n:'Goldman Sachs',w:2.8},{t:'SPGI',n:'S&P Global',w:2.7},{t:'AXP',n:'American Express',w:2.5},{t:'MS',n:'Morgan Stanley',w:2.4}]},
  XLV: { name:'Health Care Select Sector', expense:'0.09%', holdings:[
    {t:'LLY',n:'Eli Lilly',w:13.5},{t:'UNH',n:'UnitedHealth',w:10.2},{t:'JNJ',n:'Johnson & Johnson',w:6.8},{t:'ABBV',n:'AbbVie',w:6.5},{t:'MRK',n:'Merck',w:5.2},
    {t:'TMO',n:'Thermo Fisher',w:4.1},{t:'ABT',n:'Abbott',w:3.8},{t:'DHR',n:'Danaher',w:3.2},{t:'PFE',n:'Pfizer',w:2.8},{t:'AMGN',n:'Amgen',w:2.7}]},
  XLE: { name:'Energy Select Sector', expense:'0.09%', holdings:[
    {t:'XOM',n:'Exxon Mobil',w:23.1},{t:'CVX',n:'Chevron',w:16.2},{t:'COP',n:'ConocoPhillips',w:7.8},{t:'EOG',n:'EOG Resources',w:5.1},{t:'SLB',n:'Schlumberger',w:4.8},
    {t:'MPC',n:'Marathon Petrol.',w:4.5},{t:'PSX',n:'Phillips 66',w:3.9},{t:'PXD',n:'Pioneer Natural',w:3.6},{t:'VLO',n:'Valero Energy',w:3.4},{t:'WMB',n:'Williams Cos',w:3.2}]},
  XLY: { name:'Consumer Discretionary', expense:'0.09%', holdings:[
    {t:'AMZN',n:'Amazon',w:23.8},{t:'TSLA',n:'Tesla',w:15.2},{t:'HD',n:'Home Depot',w:8.5},{t:'MCD',n:'McDonald\'s',w:4.2},{t:'LOW',n:'Lowe\'s',w:3.5},
    {t:'NKE',n:'Nike',w:3.0},{t:'SBUX',n:'Starbucks',w:2.8},{t:'TJX',n:'TJX Companies',w:2.5},{t:'BKNG',n:'Booking',w:2.4},{t:'CMG',n:'Chipotle',w:1.9}]},
  XLP: { name:'Consumer Staples', expense:'0.09%', holdings:[
    {t:'PG',n:'Procter & Gamble',w:15.2},{t:'COST',n:'Costco',w:12.8},{t:'KO',n:'Coca-Cola',w:9.5},{t:'PEP',n:'PepsiCo',w:8.2},{t:'WMT',n:'Walmart',w:7.1},
    {t:'PM',n:'Philip Morris',w:5.8},{t:'MDLZ',n:'Mondelez',w:4.1},{t:'MO',n:'Altria',w:3.5},{t:'CL',n:'Colgate-Palmolive',w:3.2},{t:'ADM',n:'Archer-Daniels',w:2.1}]},
  XLI: { name:'Industrial Select Sector', expense:'0.09%', holdings:[
    {t:'GE',n:'GE Aerospace',w:6.2},{t:'CAT',n:'Caterpillar',w:5.5},{t:'UNP',n:'Union Pacific',w:4.8},{t:'RTX',n:'RTX Corp',w:4.5},{t:'HON',n:'Honeywell',w:4.2},
    {t:'DE',n:'Deere & Co',w:3.8},{t:'BA',n:'Boeing',w:3.5},{t:'LMT',n:'Lockheed Martin',w:3.2},{t:'UPS',n:'UPS',w:2.9},{t:'ADP',n:'ADP',w:2.7}]},
  XLU: { name:'Utilities Select Sector', expense:'0.09%', holdings:[
    {t:'NEE',n:'NextEra Energy',w:15.1},{t:'SO',n:'Southern Co',w:8.5},{t:'DUK',n:'Duke Energy',w:7.8},{t:'CEG',n:'Constellation',w:6.2},{t:'SRE',n:'Sempra',w:4.5},
    {t:'AEP',n:'American Electric',w:4.2},{t:'D',n:'Dominion Energy',w:3.8},{t:'EXC',n:'Exelon',w:3.5},{t:'PCG',n:'PG&E',w:3.1},{t:'XEL',n:'Xcel Energy',w:2.8}]},
  XLB: { name:'Materials Select Sector', expense:'0.09%', holdings:[
    {t:'LIN',n:'Linde',w:18.5},{t:'APD',n:'Air Products',w:7.2},{t:'SHW',n:'Sherwin-Williams',w:6.8},{t:'FCX',n:'Freeport-McMoRan',w:6.1},{t:'ECL',n:'Ecolab',w:5.2},
    {t:'NEM',n:'Newmont',w:4.8},{t:'DOW',n:'Dow Inc',w:4.1},{t:'NUE',n:'Nucor',w:3.5},{t:'DD',n:'DuPont',w:3.2},{t:'CTVA',n:'Corteva',w:3.0}]},
  XLRE: { name:'Real Estate Select Sector', expense:'0.09%', holdings:[
    {t:'PLD',n:'Prologis',w:12.5},{t:'AMT',n:'American Tower',w:9.8},{t:'EQIX',n:'Equinix',w:8.2},{t:'WELL',n:'Welltower',w:6.1},{t:'SPG',n:'Simon Property',w:5.5},
    {t:'PSA',n:'Public Storage',w:4.8},{t:'DLR',n:'Digital Realty',w:4.2},{t:'O',n:'Realty Income',w:3.9},{t:'CCI',n:'Crown Castle',w:3.5},{t:'VICI',n:'VICI Properties',w:3.1}]},
  XLC: { name:'Communication Services', expense:'0.09%', holdings:[
    {t:'META',n:'Meta Platforms',w:23.5},{t:'GOOGL',n:'Alphabet A',w:12.8},{t:'GOOG',n:'Alphabet C',w:11.2},{t:'NFLX',n:'Netflix',w:5.8},{t:'T',n:'AT&T',w:4.5},
    {t:'CMCSA',n:'Comcast',w:4.1},{t:'DIS',n:'Walt Disney',w:3.8},{t:'VZ',n:'Verizon',w:3.5},{t:'TMUS',n:'T-Mobile',w:3.2},{t:'EA',n:'Electronic Arts',w:1.8}]},
  // === INDUSTRIA ===
  XBI: { name:'S&P Biotech', expense:'0.35%', holdings:[
    {t:'MRNA',n:'Moderna',w:3.2},{t:'IONS',n:'Ionis Pharma',w:2.8},{t:'EXAS',n:'Exact Sciences',w:2.5},{t:'PCVX',n:'Vaxcyte',w:2.3},{t:'ALNY',n:'Alnylam',w:2.1},
    {t:'INSM',n:'Insmed',w:2.0},{t:'SRPT',n:'Sarepta',w:1.9},{t:'HALO',n:'Halozyme',w:1.8},{t:'NBIX',n:'Neurocrine Bio',w:1.7},{t:'BMRN',n:'BioMarin',w:1.6}]},
  XHB: { name:'S&P Homebuilders', expense:'0.35%', holdings:[
    {t:'DHI',n:'D.R. Horton',w:5.2},{t:'LEN',n:'Lennar',w:4.8},{t:'NVR',n:'NVR Inc',w:4.5},{t:'PHM',n:'PulteGroup',w:4.2},{t:'TOL',n:'Toll Brothers',w:3.8},
    {t:'WSM',n:'Williams-Sonoma',w:3.5},{t:'FND',n:'Floor & Decor',w:3.2},{t:'TPX',n:'Tempur Sealy',w:2.9},{t:'MHK',n:'Mohawk Ind.',w:2.7},{t:'BLDR',n:'Builders First',w:2.5}]},
  XME: { name:'S&P Metals & Mining', expense:'0.35%', holdings:[
    {t:'FCX',n:'Freeport-McMoRan',w:7.5},{t:'NUE',n:'Nucor',w:6.2},{t:'STLD',n:'Steel Dynamics',w:5.8},{t:'CLF',n:'Cleveland-Cliffs',w:5.1},{t:'AA',n:'Alcoa',w:4.8},
    {t:'RS',n:'Reliance Steel',w:4.5},{t:'X',n:'U.S. Steel',w:4.1},{t:'ATI',n:'ATI Inc',w:3.8},{t:'CMC',n:'Commercial Metals',w:3.5},{t:'MP',n:'MP Materials',w:3.2}]},
  XOP: { name:'S&P Oil & Gas Explor.', expense:'0.35%', holdings:[
    {t:'COP',n:'ConocoPhillips',w:5.8},{t:'EOG',n:'EOG Resources',w:5.2},{t:'DVN',n:'Devon Energy',w:4.8},{t:'MRO',n:'Marathon Oil',w:4.2},{t:'FANG',n:'Diamondback',w:3.9},
    {t:'OVV',n:'Ovintiv',w:3.5},{t:'APA',n:'APA Corp',w:3.2},{t:'MTDR',n:'Matador Res.',w:2.9},{t:'PR',n:'Permian Res.',w:2.7},{t:'CHRD',n:'Chord Energy',w:2.5}]},
  KBE: { name:'S&P Bank ETF', expense:'0.35%', holdings:[
    {t:'JPM',n:'JPMorgan',w:4.2},{t:'BAC',n:'Bank of America',w:3.8},{t:'WFC',n:'Wells Fargo',w:3.5},{t:'C',n:'Citigroup',w:3.2},{t:'USB',n:'U.S. Bancorp',w:2.9},
    {t:'PNC',n:'PNC Financial',w:2.7},{t:'TFC',n:'Truist Financial',w:2.5},{t:'SCHW',n:'Charles Schwab',w:2.3},{t:'COF',n:'Capital One',w:2.1},{t:'FITB',n:'Fifth Third',w:1.9}]},
  KRE: { name:'S&P Regional Banking', expense:'0.35%', holdings:[
    {t:'EWBC',n:'East West Bancorp',w:3.5},{t:'CFG',n:'Citizens Finl.',w:3.2},{t:'RF',n:'Regions Finl.',w:2.9},{t:'HBAN',n:'Huntington Banc.',w:2.7},{t:'KEY',n:'KeyCorp',w:2.5},
    {t:'FITB',n:'Fifth Third',w:2.3},{t:'MTB',n:'M&T Bank',w:2.1},{t:'ZION',n:'Zions Bancorp',w:1.9},{t:'CMA',n:'Comerica',w:1.8},{t:'WAL',n:'Western Alliance',w:1.7}]},
  SMH: { name:'VanEck Semiconductor', expense:'0.35%', holdings:[
    {t:'NVDA',n:'NVIDIA',w:20.5},{t:'TSM',n:'TSMC',w:12.8},{t:'AVGO',n:'Broadcom',w:8.2},{t:'AMD',n:'AMD',w:5.5},{t:'ASML',n:'ASML',w:5.1},
    {t:'TXN',n:'Texas Instruments',w:4.8},{t:'QCOM',n:'Qualcomm',w:4.5},{t:'AMAT',n:'Applied Materials',w:4.2},{t:'MU',n:'Micron',w:3.8},{t:'LRCX',n:'Lam Research',w:3.5}]},
  ITB: { name:'iShares Home Constr.', expense:'0.39%', holdings:[
    {t:'DHI',n:'D.R. Horton',w:13.2},{t:'LEN',n:'Lennar',w:11.5},{t:'NVR',n:'NVR Inc',w:8.8},{t:'PHM',n:'PulteGroup',w:7.2},{t:'TOL',n:'Toll Brothers',w:5.5},
    {t:'TMHC',n:'Taylor Morrison',w:4.2},{t:'MHO',n:'M/I Homes',w:3.8},{t:'KBH',n:'KB Home',w:3.5},{t:'MDC',n:'MDC Holdings',w:3.1},{t:'CCS',n:'Century Comm.',w:2.8}]},
  IYT: { name:'iShares Transportation', expense:'0.39%', holdings:[
    {t:'UNP',n:'Union Pacific',w:15.2},{t:'UPS',n:'UPS',w:10.5},{t:'FDX',n:'FedEx',w:7.8},{t:'CSX',n:'CSX Corp',w:6.5},{t:'NSC',n:'Norfolk Southern',w:5.2},
    {t:'DAL',n:'Delta Air Lines',w:4.8},{t:'UBER',n:'Uber',w:4.5},{t:'LUV',n:'Southwest',w:3.2},{t:'UAL',n:'United Airlines',w:2.9},{t:'ODFL',n:'Old Dominion',w:2.7}]},
  // === TEM√ÅTICO ===
  ARKK: { name:'ARK Innovation ETF', expense:'0.75%', holdings:[
    {t:'TSLA',n:'Tesla',w:11.5},{t:'COIN',n:'Coinbase',w:8.2},{t:'ROKU',n:'Roku',w:7.8},{t:'SQ',n:'Block Inc',w:6.5},{t:'RBLX',n:'Roblox',w:5.2},
    {t:'PATH',n:'UiPath',w:4.8},{t:'SHOP',n:'Shopify',w:4.5},{t:'PLTR',n:'Palantir',w:4.2},{t:'DKNG',n:'DraftKings',w:3.8},{t:'CRSP',n:'CRISPR',w:3.5}]},
  TAN: { name:'Invesco Solar ETF', expense:'0.67%', holdings:[
    {t:'ENPH',n:'Enphase',w:10.2},{t:'FSLR',n:'First Solar',w:9.8},{t:'SEDG',n:'SolarEdge',w:5.5},{t:'RUN',n:'Sunrun',w:5.1},{t:'ARRY',n:'Array Tech',w:4.2},
    {t:'NOVA',n:'Sunnova',w:3.8},{t:'CSIQ',n:'Canadian Solar',w:3.5},{t:'JKS',n:'JinkoSolar',w:3.2},{t:'MAXN',n:'Maxeon Solar',w:2.8},{t:'SHLS',n:'Shoals Tech',w:2.5}]},
  HACK: { name:'ETFMG Cybersecurity', expense:'0.60%', holdings:[
    {t:'CRWD',n:'CrowdStrike',w:6.8},{t:'PANW',n:'Palo Alto',w:6.5},{t:'FTNT',n:'Fortinet',w:5.8},{t:'ZS',n:'Zscaler',w:5.2},{t:'OKTA',n:'Okta',w:4.5},
    {t:'NET',n:'Cloudflare',w:4.2},{t:'S',n:'SentinelOne',w:3.8},{t:'CYBR',n:'CyberArk',w:3.5},{t:'TENB',n:'Tenable',w:3.1},{t:'RPD',n:'Rapid7',w:2.8}]},
  LIT: { name:'Global X Lithium & Battery', expense:'0.75%', holdings:[
    {t:'ALB',n:'Albemarle',w:10.5},{t:'SQM',n:'Sociedad Qu√≠mica',w:7.8},{t:'TEM',n:'Tianqi Lithium',w:5.2},{t:'LTHM',n:'Livent',w:4.8},{t:'LAC',n:'Lithium Americas',w:4.2},
    {t:'PLL',n:'Piedmont Lithium',w:3.5},{t:'BYDDY',n:'BYD Co',w:3.2},{t:'TSLA',n:'Tesla',w:2.8},{t:'PANW',n:'Panasonic',w:2.5},{t:'ENR',n:'Energizer',w:2.1}]},
  BOTZ: { name:'Global X Robotics & AI', expense:'0.68%', holdings:[
    {t:'NVDA',n:'NVIDIA',w:12.8},{t:'ISRG',n:'Intuitive Surg.',w:9.5},{t:'ABB',n:'ABB Ltd',w:6.2},{t:'FANUY',n:'Fanuc',w:5.8},{t:'KYCCF',n:'Keyence',w:5.2},
    {t:'IRBT',n:'iRobot',w:3.8},{t:'BRKS',n:'Brooks Autom.',w:3.5},{t:'ISRG',n:'Intuitive Surg.',w:3.2},{t:'TER',n:'Teradyne',w:2.9},{t:'OMCL',n:'Omnicell',w:2.5}]},
  // === FACTOR ===
  MTUM: { name:'iShares Momentum Factor', expense:'0.15%', holdings:[
    {t:'NVDA',n:'NVIDIA',w:6.8},{t:'META',n:'Meta Platforms',w:5.5},{t:'LLY',n:'Eli Lilly',w:4.8},{t:'AVGO',n:'Broadcom',w:4.2},{t:'COST',n:'Costco',w:3.5},
    {t:'NFLX',n:'Netflix',w:3.2},{t:'GE',n:'GE Aerospace',w:2.9},{t:'ANET',n:'Arista Networks',w:2.5},{t:'NOW',n:'ServiceNow',w:2.3},{t:'URI',n:'United Rentals',w:2.1}]},
  QUAL: { name:'iShares Quality Factor', expense:'0.15%', holdings:[
    {t:'AAPL',n:'Apple',w:8.5},{t:'MSFT',n:'Microsoft',w:7.8},{t:'NVDA',n:'NVIDIA',w:6.2},{t:'META',n:'Meta Platforms',w:4.5},{t:'GOOGL',n:'Alphabet',w:3.8},
    {t:'JNJ',n:'Johnson & Johnson',w:3.2},{t:'V',n:'Visa',w:2.9},{t:'MA',n:'Mastercard',w:2.5},{t:'PG',n:'Procter & Gamble',w:2.3},{t:'HD',n:'Home Depot',w:2.1}]},
  VLUE: { name:'iShares Value Factor', expense:'0.15%', holdings:[
    {t:'BRK.B',n:'Berkshire Hath.',w:5.2},{t:'JPM',n:'JPMorgan',w:4.5},{t:'JNJ',n:'Johnson & Johnson',w:3.8},{t:'BAC',n:'Bank of America',w:3.2},{t:'INTC',n:'Intel',w:2.8},
    {t:'CSCO',n:'Cisco',w:2.5},{t:'WFC',n:'Wells Fargo',w:2.2},{t:'PFE',n:'Pfizer',w:2.0},{t:'CMCSA',n:'Comcast',w:1.8},{t:'T',n:'AT&T',w:1.6}]},
  SIZE: { name:'iShares Size Factor', expense:'0.15%', holdings:[
    {t:'KEY',n:'KeyCorp',w:0.8},{t:'NWL',n:'Newell Brands',w:0.7},{t:'AES',n:'AES Corp',w:0.7},{t:'IPG',n:'Interpublic',w:0.6},{t:'PARA',n:'Paramount',w:0.6},
    {t:'WBA',n:'Walgreens',w:0.5},{t:'HII',n:'Huntington Ing.',w:0.5},{t:'MOS',n:'Mosaic',w:0.5},{t:'BWA',n:'BorgWarner',w:0.5},{t:'TAP',n:'Molson Coors',w:0.4}]},
  // === BROAD / GROWTH / VALUE ===
  QQQ: { name:'Invesco QQQ Trust', expense:'0.20%', holdings:[
    {t:'AAPL',n:'Apple',w:11.2},{t:'MSFT',n:'Microsoft',w:10.5},{t:'NVDA',n:'NVIDIA',w:8.8},{t:'AMZN',n:'Amazon',w:5.8},{t:'META',n:'Meta Platforms',w:5.2},
    {t:'AVGO',n:'Broadcom',w:4.5},{t:'GOOGL',n:'Alphabet A',w:3.8},{t:'GOOG',n:'Alphabet C',w:3.5},{t:'TSLA',n:'Tesla',w:3.2},{t:'COST',n:'Costco',w:2.8}]},
  IWM: { name:'iShares Russell 2000', expense:'0.19%', holdings:[
    {t:'SMCI',n:'Super Micro',w:1.2},{t:'CELH',n:'Celsius Hold.',w:0.5},{t:'TOST',n:'Toast',w:0.4},{t:'ELF',n:'e.l.f. Beauty',w:0.4},{t:'DUOL',n:'Duolingo',w:0.4},
    {t:'FN',n:'Fabrinet',w:0.3},{t:'CARG',n:'CarGurus',w:0.3},{t:'LUMN',n:'Lumen Tech',w:0.3},{t:'ANF',n:'Abercrombie',w:0.3},{t:'COOP',n:'Mr. Cooper',w:0.3}]},
  DIA: { name:'SPDR Dow Jones Industrial', expense:'0.16%', holdings:[
    {t:'UNH',n:'UnitedHealth',w:9.2},{t:'GS',n:'Goldman Sachs',w:7.8},{t:'MSFT',n:'Microsoft',w:6.5},{t:'HD',n:'Home Depot',w:6.1},{t:'CAT',n:'Caterpillar',w:5.5},
    {t:'AMGN',n:'Amgen',w:5.2},{t:'V',n:'Visa',w:4.5},{t:'MCD',n:'McDonald\'s',w:4.2},{t:'CRM',n:'Salesforce',w:3.8},{t:'TRV',n:'Travelers',w:3.5}]},
  VTV: { name:'Vanguard Value ETF', expense:'0.04%', holdings:[
    {t:'BRK.B',n:'Berkshire Hath.',w:4.2},{t:'JPM',n:'JPMorgan',w:3.5},{t:'XOM',n:'Exxon Mobil',w:3.2},{t:'UNH',n:'UnitedHealth',w:3.0},{t:'JNJ',n:'Johnson & Johnson',w:2.8},
    {t:'PG',n:'Procter & Gamble',w:2.5},{t:'HD',n:'Home Depot',w:2.2},{t:'CVX',n:'Chevron',w:2.0},{t:'ABBV',n:'AbbVie',w:1.9},{t:'MRK',n:'Merck',w:1.8}]},
  VUG: { name:'Vanguard Growth ETF', expense:'0.04%', holdings:[
    {t:'AAPL',n:'Apple',w:13.5},{t:'MSFT',n:'Microsoft',w:12.8},{t:'NVDA',n:'NVIDIA',w:10.2},{t:'AMZN',n:'Amazon',w:6.5},{t:'META',n:'Meta Platforms',w:5.2},
    {t:'GOOGL',n:'Alphabet A',w:3.8},{t:'LLY',n:'Eli Lilly',w:3.5},{t:'AVGO',n:'Broadcom',w:3.2},{t:'TSLA',n:'Tesla',w:2.8},{t:'GOOG',n:'Alphabet C',w:2.5}]},
  RSP: { name:'Invesco S&P 500 Equal Weight', expense:'0.20%', holdings:[
    {t:'AAPL',n:'Apple',w:0.22},{t:'MSFT',n:'Microsoft',w:0.22},{t:'NVDA',n:'NVIDIA',w:0.21},{t:'AMZN',n:'Amazon',w:0.21},{t:'GOOGL',n:'Alphabet',w:0.21},
    {t:'META',n:'Meta',w:0.21},{t:'BRK.B',n:'Berkshire',w:0.21},{t:'JPM',n:'JPMorgan',w:0.21},{t:'V',n:'Visa',w:0.21},{t:'LLY',n:'Eli Lilly',w:0.21}]},
  // === INTERNATIONAL ===
  EEM: { name:'iShares MSCI Emerging Markets', expense:'0.68%', holdings:[
    {t:'TSM',n:'TSMC',w:9.8},{t:'BABA',n:'Alibaba',w:3.5},{t:'TCEHY',n:'Tencent',w:3.2},{t:'005930.KS',n:'Samsung',w:2.8},{t:'RELIANCE.NS',n:'Reliance Ind.',w:2.1},
    {t:'PDD',n:'PDD Holdings',w:1.8},{t:'INFY',n:'Infosys',w:1.5},{t:'VALE',n:'Vale SA',w:1.3},{t:'JD',n:'JD.com',w:1.1},{t:'BIDU',n:'Baidu',w:0.9}]},
  EFA: { name:'iShares MSCI EAFE', expense:'0.32%', holdings:[
    {t:'ASML',n:'ASML',w:2.5},{t:'NOVO-B.CO',n:'Novo Nordisk',w:2.2},{t:'NESN.SW',n:'Nestl√©',w:1.8},{t:'ROG.SW',n:'Roche',w:1.5},{t:'AZN',n:'AstraZeneca',w:1.4},
    {t:'SHEL',n:'Shell',w:1.3},{t:'MC.PA',n:'LVMH',w:1.2},{t:'TTE',n:'TotalEnergies',w:1.1},{t:'SAP',n:'SAP',w:1.0},{t:'HSBC',n:'HSBC',w:0.9}]},
  // === COMMODITIES / FIXED INCOME ===
  GLD: { name:'SPDR Gold Shares', expense:'0.40%', holdings:[{t:'Gold',n:'Physical Gold Bullion',w:100}]},
  SLV: { name:'iShares Silver Trust', expense:'0.50%', holdings:[{t:'Silver',n:'Physical Silver Bullion',w:100}]},
  USO: { name:'United States Oil Fund', expense:'0.60%', holdings:[{t:'CL',n:'WTI Crude Futures',w:100}]},
  TLT: { name:'iShares 20+ Year Treasury', expense:'0.15%', holdings:[{t:'UST',n:'US Treasury Bonds 20-30yr',w:100}]},
  HYG: { name:'iShares High Yield Corporate', expense:'0.49%', holdings:[{t:'HY',n:'High Yield Corp Bonds',w:100}]},
  LQD: { name:'iShares Invest. Grade Corp.', expense:'0.14%', holdings:[{t:'IG',n:'Invest. Grade Corp Bonds',w:100}]},
  // === OTHER POPULAR ===
  SOXX: { name:'iShares Semiconductor', expense:'0.35%', holdings:[
    {t:'NVDA',n:'NVIDIA',w:10.2},{t:'AVGO',n:'Broadcom',w:9.8},{t:'AMD',n:'AMD',w:7.5},{t:'QCOM',n:'Qualcomm',w:6.2},{t:'TXN',n:'Texas Instruments',w:5.8},
    {t:'AMAT',n:'Applied Materials',w:5.2},{t:'MU',n:'Micron',w:4.8},{t:'LRCX',n:'Lam Research',w:4.5},{t:'KLAC',n:'KLA Corp',w:4.1},{t:'ADI',n:'Analog Devices',w:3.8}]},
  IGV: { name:'iShares Software', expense:'0.40%', holdings:[
    {t:'MSFT',n:'Microsoft',w:9.5},{t:'CRM',n:'Salesforce',w:7.8},{t:'ADBE',n:'Adobe',w:6.2},{t:'NOW',n:'ServiceNow',w:5.5},{t:'ORCL',n:'Oracle',w:5.1},
    {t:'INTU',n:'Intuit',w:4.5},{t:'SNPS',n:'Synopsys',w:4.2},{t:'CDNS',n:'Cadence',w:3.8},{t:'PANW',n:'Palo Alto',w:3.5},{t:'CRWD',n:'CrowdStrike',w:3.2}]},
  XRT: { name:'S&P Retail ETF', expense:'0.35%', holdings:[
    {t:'GME',n:'GameStop',w:2.5},{t:'CVNA',n:'Carvana',w:2.2},{t:'BBY',n:'Best Buy',w:1.9},{t:'W',n:'Wayfair',w:1.8},{t:'KSS',n:'Kohl\'s',w:1.7},
    {t:'DKS',n:'Dick\'s Sporting',w:1.6},{t:'FIVE',n:'Five Below',w:1.5},{t:'ANF',n:'Abercrombie',w:1.4},{t:'GPS',n:'Gap Inc',w:1.3},{t:'BURL',n:'Burlington',w:1.2}]},
  KWEB: { name:'KraneShares China Internet', expense:'0.68%', holdings:[
    {t:'BABA',n:'Alibaba',w:10.5},{t:'PDD',n:'PDD Holdings',w:9.8},{t:'TCEHY',n:'Tencent',w:8.5},{t:'JD',n:'JD.com',w:7.2},{t:'BIDU',n:'Baidu',w:5.5},
    {t:'NTES',n:'NetEase',w:4.8},{t:'BEKE',n:'KE Holdings',w:3.5},{t:'BILI',n:'Bilibili',w:3.2},{t:'TME',n:'Tencent Music',w:2.8},{t:'ZTO',n:'ZTO Express',w:2.5}]},
  GDX: { name:'VanEck Gold Miners', expense:'0.51%', holdings:[
    {t:'NEM',n:'Newmont',w:13.5},{t:'GOLD',n:'Barrick Gold',w:9.8},{t:'AEM',n:'Agnico Eagle',w:8.5},{t:'WPM',n:'Wheaton Prec.',w:6.2},{t:'FNV',n:'Franco-Nevada',w:5.5},
    {t:'GFI',n:'Gold Fields',w:4.8},{t:'RGLD',n:'Royal Gold',w:3.5},{t:'KGC',n:'Kinross Gold',w:3.2},{t:'AU',n:'AngloGold',w:2.8},{t:'HMY',n:'Harmony Gold',w:2.5}]},
  GDXJ: { name:'VanEck Junior Gold Miners', expense:'0.52%', holdings:[
    {t:'AU',n:'AngloGold',w:5.2},{t:'HMY',n:'Harmony Gold',w:4.8},{t:'BTG',n:'B2Gold',w:4.5},{t:'CDE',n:'Coeur Mining',w:3.8},{t:'EGO',n:'Eldorado Gold',w:3.5},
    {t:'HL',n:'Hecla Mining',w:3.2},{t:'SSRM',n:'SSR Mining',w:2.9},{t:'MAG',n:'MAG Silver',w:2.5},{t:'OR',n:'Osisko Gold',w:2.2},{t:'NGD',n:'New Gold',w:2.0}]},
  IBIT: { name:'iShares Bitcoin Trust', expense:'0.25%', holdings:[{t:'BTC',n:'Bitcoin',w:100}]},
  VNQ: { name:'Vanguard Real Estate', expense:'0.12%', holdings:[
    {t:'PLD',n:'Prologis',w:8.2},{t:'AMT',n:'American Tower',w:6.5},{t:'EQIX',n:'Equinix',w:5.8},{t:'WELL',n:'Welltower',w:4.2},{t:'SPG',n:'Simon Property',w:3.8},
    {t:'DLR',n:'Digital Realty',w:3.5},{t:'PSA',n:'Public Storage',w:3.2},{t:'O',n:'Realty Income',w:2.9},{t:'CCI',n:'Crown Castle',w:2.5},{t:'VICI',n:'VICI Properties',w:2.2}]},
};

// Optional: API Ninjas key for ETFs not in the database above
const API_NINJAS_KEY = ''; // Pon aqu√≠ tu key de api-ninjas.com si quieres

// Holdings cache for API fetches
const holdingsCache = {};

function renderHoldings(ticker) {
  const content = document.getElementById('tv-holdings-content');
  const meta = document.getElementById('tv-holdings-meta');
  
  // Check local database first
  const local = ETF_HOLDINGS[ticker];
  if (local) {
    meta.textContent = `${local.name} ¬∑ Expense Ratio: ${local.expense}`;
    content.innerHTML = '<div class="holdings-grid">' + local.holdings.map((h,i) =>
      `<div class="holding-item">
        <div><span class="holding-ticker">${h.t}</span><span class="holding-name">${h.n}</span></div>
        <span class="holding-weight">${h.w < 1 ? h.w.toFixed(2) : h.w.toFixed(1)}%</span>
      </div>`
    ).join('') + '</div>';
    return;
  }

  // Check cache
  if (holdingsCache[ticker]) {
    const c = holdingsCache[ticker];
    meta.textContent = c.meta;
    content.innerHTML = c.html;
    return;
  }

  // Try API Ninjas if key is set
  if (API_NINJAS_KEY) {
    content.innerHTML = '<div class="holdings-loading">üîç Buscando holdings...</div>';
    meta.textContent = '';
    fetch('https://api.api-ninjas.com/v1/etf?ticker=' + ticker, {
      headers: { 'X-Api-Key': API_NINJAS_KEY }
    })
    .then(r => r.json())
    .then(data => {
      if (data && data.holdings && data.holdings.length > 0) {
        const top10 = data.holdings.slice(0, 10);
        const expenseText = data.expense_ratio ? `Expense Ratio: ${data.expense_ratio}%` : '';
        const aumText = data.assets_under_management ? `AUM: $${(data.assets_under_management/1e9).toFixed(1)}B` : '';
        const metaText = [data.name || ticker, expenseText, aumText].filter(Boolean).join(' ¬∑ ');
        meta.textContent = metaText;
        const html = '<div class="holdings-grid">' + top10.map(h =>
          `<div class="holding-item">
            <div><span class="holding-ticker">${h.ticker||h.symbol||'‚Äî'}</span><span class="holding-name">${h.name||''}</span></div>
            <span class="holding-weight">${parseFloat(h.weight||h.percentage||0).toFixed(1)}%</span>
          </div>`
        ).join('') + '</div>';
        content.innerHTML = html;
        holdingsCache[ticker] = { meta: metaText, html };
      } else {
        meta.textContent = '';
        content.innerHTML = '<div class="holdings-loading" style="color:var(--text-muted)">No se encontraron holdings para ' + ticker + '</div>';
      }
    })
    .catch(() => {
      meta.textContent = '';
      content.innerHTML = '<div class="holdings-loading" style="color:var(--text-muted)">Holdings no disponibles para ' + ticker + '</div>';
    });
  } else {
    meta.textContent = '';
    content.innerHTML = '<div class="holdings-loading" style="color:var(--text-muted)">Holdings no disponibles para ' + ticker + '</div>';
  }
}

// ===== PRELOAD TRADINGVIEW =====
let tvScriptLoaded = false;
const tvScript = document.createElement('script');
tvScript.src = 'https://s3.tradingview.com/tv.js';
tvScript.onload = () => { tvScriptLoaded = true; };
document.head.appendChild(tvScript);

// ===== TRADINGVIEW CHART =====
function openChart(ticker, category, rsScore, pctl) {
  const overlay = document.getElementById('tv-overlay');
  const container = document.getElementById('tv-chart-container');
  const isLight = document.documentElement.dataset.theme === 'light';
  
  document.getElementById('tv-ticker').textContent = ticker;
  document.getElementById('tv-cat').textContent = category;
  
  const rsColor = rsScore > 0 ? 'var(--green-strong)' : 'var(--red)';
  document.getElementById('tv-rs-score').innerHTML = `RS: <span style="color:${rsColor};font-weight:700">${rsScore > 0 ? '+' : ''}${rsScore}</span>`;
  
  const sigClass = pctl >= 75 ? 'fuerte' : pctl >= 50 ? 'positivo' : pctl >= 25 ? 'neutral' : 'debil';
  const sigText = pctl >= 75 ? 'üü¢ FUERTE' : pctl >= 50 ? 'üîµ POSITIVO' : pctl >= 25 ? 'üü° NEUTRAL' : 'üî¥ D√âBIL';
  document.getElementById('tv-signal').innerHTML = `Pctl: <span style="font-weight:700">${pctl}</span> ${sigText}`;
  
  // Create TradingView widget
  container.innerHTML = '';
  const widgetDiv = document.createElement('div');
  widgetDiv.id = 'tradingview_widget_' + Date.now();
  widgetDiv.style.width = '100%';
  widgetDiv.style.height = '100%';
  container.appendChild(widgetDiv);

  function createWidget() {
    new TradingView.widget({
      "autosize": true,
      "symbol": ticker,
      "interval": "D",
      "timezone": "Europe/Madrid",
      "theme": isLight ? "light" : "dark",
      "style": "1",
      "locale": "es",
      "toolbar_bg": isLight ? "#ffffff" : "#12121a",
      "enable_publishing": false,
      "hide_top_toolbar": false,
      "hide_legend": false,
      "save_image": false,
      "allow_symbol_change": true,
      "container_id": widgetDiv.id,
      "studies": ["RSI@tv-basicstudies", "MASimple@tv-basicstudies"],
      "range": "6M",
      "overrides": {
        "mainSeriesProperties.candleStyle.upColor": "#00e676",
        "mainSeriesProperties.candleStyle.downColor": "#ff5252"
      }
    });
  }

  if (tvScriptLoaded && typeof TradingView !== 'undefined') {
    createWidget();
  } else {
    tvScript.onload = () => { tvScriptLoaded = true; createWidget(); };
  }
  
  // Render holdings
  renderHoldings(ticker);
  
  overlay.classList.add('active');
  document.body.style.overflow = 'hidden';
}

function closeChart() {
  document.getElementById('tv-overlay').classList.remove('active');
  document.getElementById('tv-chart-container').innerHTML = '';
  document.body.style.overflow = '';
}

document.getElementById('tv-close').addEventListener('click', closeChart);
document.getElementById('tv-overlay').addEventListener('click', (e) => {
  if (e.target === e.currentTarget) closeChart();
});
document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape') closeChart();
});

// ===== HEATMAP =====
function hmColor(val, maxAbs) {
  if (maxAbs === 0) return '#555';
  var ratio = Math.max(-1, Math.min(1, val / maxAbs));
  if (ratio >= 0) {
    if (ratio > 0.6) return 'rgb(27,' + Math.round(94 + ratio * 60) + ',32)';
    if (ratio > 0.3) return 'rgb(67,160,71)';
    return 'rgb(' + Math.round(80 + (1 - ratio) * 10) + ',' + Math.round(100 + ratio * 40) + ',' + Math.round(80 + (1 - ratio) * 10) + ')';
  } else {
    var i = -ratio;
    if (i > 0.6) return 'rgb(183,28,28)';
    if (i > 0.3) return 'rgb(211,47,47)';
    return 'rgb(' + Math.round(140 + i * 40) + ',' + Math.round(80 - i * 30) + ',' + Math.round(80 - i * 30) + ')';
  }
}

function drawHeatmap() {
  var metric = document.getElementById('hm-metric').value;
  var groupBy = document.getElementById('hm-group').value;
  var canvas = document.getElementById('hm-canvas');
  
  var data = allDataWithSPY.map(function(d) {
    var etfData = allData.find(function(e) { return e.ticker === d.ticker; });
    var val = 0;
    if (metric === 'roc1m') val = d.roc1m;
    else if (metric === 'roc3m') val = d.roc3m;
    else if (metric === 'roc6m') val = d.roc6m;
    else if (metric === 'roc12m') val = d.roc12m;
    else if (etfData) {
      if (metric === 'rsScore') val = etfData.rsScore;
      else if (metric === 'rs1m') val = etfData.rs1m;
      else if (metric === 'rs3m') val = etfData.rs3m;
      else if (metric === 'rs6m') val = etfData.rs6m;
      else if (metric === 'rs12m') val = etfData.rs12m;
      else if (metric === 'pctlScore') val = etfData.pctlScore;
    }
    return { ticker: d.ticker, cat: d.cat, subcat: d.subcat || d.cat, val: val, absVal: Math.abs(val) };
  }).filter(function(d) { return d.ticker && d.ticker !== 'SPY'; });
  
  data.sort(function(a, b) { return b.absVal - a.absVal; });
  var maxAbs = Math.max.apply(null, data.map(function(d) { return d.absVal; }));
  if (maxAbs === 0) maxAbs = 1;
  var minSize = 70, maxSize = 150;
  
  var groups = {};
  if (groupBy === 'none') { groups['Todos los ETFs'] = data; }
  else { data.forEach(function(d) { var k = groupBy === 'cat' ? d.cat : d.subcat; if (!k) k = 'Otro'; if (!groups[k]) groups[k] = []; groups[k].push(d); }); }
  
  var groupKeys = Object.keys(groups).sort(function(a, b) {
    var avgA = groups[a].reduce(function(s, d) { return s + d.val; }, 0) / groups[a].length;
    var avgB = groups[b].reduce(function(s, d) { return s + d.val; }, 0) / groups[b].length;
    return avgB - avgA;
  });
  
  var html = '';
  groupKeys.forEach(function(group) {
    var items = groups[group];
    html += '<div class="hm-group-section">';
    if (groupBy !== 'none') {
      var avgVal = items.reduce(function(s, d) { return s + d.val; }, 0) / items.length;
      html += '<div class="hm-group-label">' + group + ' <span style="font-family:JetBrains Mono;font-size:0.75rem;color:' + (avgVal >= 0 ? 'var(--green-strong)' : 'var(--red)') + '">' + (avgVal >= 0 ? '+' : '') + avgVal.toFixed(2) + '</span></div>';
    }
    html += '<div class="hm-grid">';
    items.forEach(function(d) {
      var size = minSize + ((d.absVal / maxAbs) * (maxSize - minSize));
      var prefix = d.val > 0 ? '+' : '';
      var displayVal = metric === 'pctlScore' ? d.val.toFixed(1) + '%' : prefix + d.val.toFixed(2);
      html += '<div class="hm-cell" style="width:' + size + 'px;height:' + size + 'px;background:' + hmColor(d.val, maxAbs) + '" onclick="openChartFromHM(\'' + d.ticker + '\')" title="' + d.ticker + ': ' + displayVal + '">';
      html += '<div class="hm-cell-ticker">' + d.ticker + '</div>';
      html += '<div class="hm-cell-val">' + displayVal + '</div>';
      html += '</div>';
    });
    html += '</div></div>';
  });
  canvas.innerHTML = html;
}

document.getElementById('hm-metric').addEventListener('change', function() { drawHeatmap(); });
document.getElementById('hm-group').addEventListener('change', function() { drawHeatmap(); });

function openChartFromHM(ticker) {
  const d = allData.find(e => e.ticker === ticker);
  if (d) openChart(ticker, (d.subcat||d.cat).replace(/'/g,"\\'"), d.rsScore.toFixed(2), d.pctlScore.toFixed(1));
  else openChart(ticker, '', 0, 50);
}

// ===== THEME TOGGLE =====
const toggleBtn = document.getElementById('theme-toggle');
const toggleKnob = document.getElementById('toggle-knob');
function setTheme(theme) {
  document.documentElement.dataset.theme = theme;
  toggleKnob.textContent = theme === 'light' ? '‚òÄÔ∏è' : 'üåô';
  localStorage.setItem('rs-theme', theme);
  // Redraw charts if visible
  if (allData.length) {
    if (document.getElementById('tab-corr').classList.contains('active')) drawCorrelation();
    if (document.getElementById('tab-heatmap').classList.contains('active')) drawHeatmap();
  }
}
toggleBtn.addEventListener('click', () => {
  const current = document.documentElement.dataset.theme || 'dark';
  setTheme(current === 'dark' ? 'light' : 'dark');
});
// Load saved preference
const savedTheme = localStorage.getItem('rs-theme');
if (savedTheme) setTheme(savedTheme);

// ===== INIT =====
fetchData();
setInterval(fetchData, 20*60*1000);
</script>
</body>
</html>
